{
    "llm_config": {
        "model_name": "gpt-4o",
        "temperature": 0.3
    },
    "max_iterations": 15000,
    "max_execution_seconds": 300,
    "commondefs": {
        "replacement_strings": {
            "instructions_prefix": """
You are in charge of a portion of the capabilities in an enterprise company.
Only answer inquiries that are directly within your area of expertise,
from the company's perspective.
Do not try to help for personal matters.
Do not mention what you can NOT do. Only mention what you can do.
            """,
            "aaosa_instructions": """
When you receive an inquiry, you will:

    1. Call your tools to determine which down-chain agents in your tools are
       responsible for all or part of it.
    2. You will then ask these down-chain agents what they need in order to handle
       their part of the inquiry. Once the requirements are gathered, you will,
    3. Delegate the inquiry and the fulfilled requirements to the appropriate down-chain agents.
    4. Once all down-chain agents respond, you will compile their responses and return the final response.

You may, in turn, be called by other agents in the system and have to act as a down-chain to them.
            """
        },
        "replacement_values": {
            "aaosa_call": {
                "description": "Depending on the mode, returns a natural language string in response.",
                "parameters": {
                    "type": "object",
                    "properties": {
                        "inquiry": {
                            "type": "string",
                            "description": "The user's inquiry"
                        },
                        "mode": {
                            "type": "string",
                            "description": "Mode to determine responsibility, gather requirements, or return a response."
                        }
                    },
                    "required": ["inquiry", "mode"]
                }
            },
            "aaosa_command": "Explain if you can respond to all or parts of the inquiry and what you need in order to respond, if anything."
        }
    },
    "tools": [
        {
            "name": "access_request_orchestrator_agent",
            "function": {
                "description": "Main agent for company employees' access requests."
            },
            "instructions": """
            Hello! Welcome to the Enterprise Access Portal. I can help you with:
            • **New Access Requests** - for applications like Dataiku, LMS, and others
            • **Access Issues & Troubleshooting** - resolve problems with existing access
            • **FAQ & Knowledge Base** - answers to frequently asked questions

            **ROUTING LOGIC:**

            **For FAQ/Questions: → Route to knowledge_base_agent**
            - Keywords: "FAQ", "question", "help", "how to", "what is", "frequently asked", "knowledge base"
            - User asking general questions about policies, procedures, or common issues

            **For Access Issues: → Route to access_issue_agent**
            - Keywords: "problem", "issue", "not working", "can't access", "error", "trouble"
            - User experiencing problems with existing access

            **For NEW ACCESS workflow: → Handle directly**
            - Keywords: "access", "request", "need access", "new user", application names
            - Follow the workflow below

            **NEW ACCESS WORKFLOW:**
            1. Call validation_service with tool_name='prompt_retriever' and agent_name='access_request_orchestrator_agent'
            2. Once application specified, call validation_service with tool_name='prompt_retriever',
               agent_name='access_request_orchestrator_agent', and use_case='dataiku' or 'LMS'
            3. Follow the detailed instructions received from prompt templates

            What can I help you with today?
            """,
            "tools": [
                "validation_service",
                "ons_agent",
                "access_issue_agent",
                "knowledge_base_agent"
            ],
            "llm_config": {
                "model_name": "gpt-4o",
                "temperature": 0.3
            }
        },
        // --- MCP ADAPTER FOR VALIDATION SERVICE ---
        {
            "name": "validation_service",
            "description": "A remote service for handling all validation checks, including user identity, training, and policy compliance. Available tools: user_verification, training_requirements, training_completions, approvals_required, prompt_retriever. For prompt_retriever, use use_case='dataiku' or use_case='LMS' when calling for access_request_orchestrator_agent to get specialized instructions.",
            "function": {
                "description": "Access validation tools via MCP server. Use tool_name parameter to specify which tool to invoke.",
                "parameters": {
                    "type": "object",
                    "properties": {
                        "tool_name": {
                            "type": "string",
                            "description": "Name of the MCP tool to invoke (user_verification, training_requirements, training_completions, approvals_required, prompt_retriever)"
                        },
                        "env": {
                            "type": "string",
                            "description": "Environment type (DEV, QA, PROD, CORE++) - required for training_requirements and approvals_required"
                        },
                        "training_name": {
                            "type": "string",
                            "description": "Training name - required for training_completions"
                        },
                        "certificate_id": {
                            "type": "string",
                            "description": "Certificate ID - required for training_completions"
                        },
                        "access_type": {
                            "type": "string",
                            "description": "Access type (Read, Write, Execute) - required for approvals_required"
                        },
                        "agent_name": {
                            "type": "string",
                            "description": "Agent name - required for prompt_retriever"
                        },
                        "use_case": {
                            "type": "string",
                            "description": "Use case for agents that support multiple applications - for now only 'dataiku' or 'LMS', always choose one of them or None if you are not sure"
                        }
                    },
                    "required": ["tool_name"]
                }
            },
            "class": "mcp.mcp_tool_adapter.MCPToolAdapter",
            "args": {
                "base_url": "http://localhost:8000/mcp/"
            }
        },
        {
            "name": "ons_agent",
            "function": "aaosa_call",
            "instructions": "IMPORTANT: Before processing any inquiry, call validation_service with tool_name='prompt_retriever' and agent_name='ons_agent' to get your detailed instructions. Once you have retrieved your full instructions, follow them completely for handling the inquiry.",
            "llm_config": {
                "model_name": "gpt-4o",
                "temperature": 0.3
            },
            "tools": [
                "validation_service",
                "ons_ticket_verification_tool",
                "ons_ticket_creator_tool"
            ]
        },
        // --- ONS (ServiceNow) TOOLS (LOCAL IMPLEMENTATIONS) ---
        {
            "name": "ons_ticket_verification_tool",
            "function": {
                "description": "Simple validator for ServiceNow ticket numbers.",
                "parameters": {
                    "type": "object",
                    "properties": {
                        "ticket_number": {"type": "string", "description": "Ticket number"}
                    },
                    "required": ["ticket_number"]
                }
            },
            "class": "tools.ons_ticket_verification_tool.ONSTicketVerificationTool"
        },
        {
            "name": "ons_ticket_creator_tool",
            "function": {
                "description": "Generate a mock ServiceNow ticket number for access requests.",
                "parameters": {
                    "type": "object",
                    "properties": {
                        "access_request_details": {
                            "type": "string",
                            "description": "Details of the access request including environment and access type"
                        }
                    },
                    "required": ["access_request_details"]
                }
            },
            "class": "tools.ons_ticket_creator_tool.ONSTicketCreatorTool"
        },
        {
            "name": "access_issue_agent",
            "function": "aaosa_call",
            "instructions": """
            IMPORTANT: You are responsible for handling access issues for company employees. When you get called:

            1. First, gather details about the access issue from the user
            2. Call 'issue_ticket_creator_tool' to create an incident ticket with the issue details
            3. Take the incident number returned from step 2 and call 'incident_debugging_agent_tool' to analyze and resolve the issue
            4. Wait for the debugging analysis to complete and return a friendly, helpful message to the user with:
               - The incident number for their reference
               - A summary of the analysis/resolution provided by the debugging system
               - Next steps or recommendations if any

            Always maintain a professional and supportive tone when communicating with users about their access issues.
            """,
            "llm_config": {
                "model_name": "gpt-4o",
                "temperature": 0.3
            },
            "tools": [
                "issue_ticket_creator_tool",
                "incident_debugging_agent_tool"
            ]
        },
        {
            "name": "issue_ticket_creator_tool",
            "function": {
                "description": "Generate a mock ServiceNow ticket number for access requests.",
                "parameters": {
                    "type": "object",
                    "properties": {
                        "access_request_details": {
                            "type": "string",
                            "description": "Details of the access request including environment and access type"
                        }
                    },
                    "required": ["access_request_details"]
                }
            },
            "class": "tools.issue_creator_tool.IssueCreatorTool"
        },
        {
            "name": "incident_debugging_agent_tool",
            "function": {
                "description": "Call external agent network to debug and analyze incident problems, returning solution to user.",
                "parameters": {
                    "type": "object",
                    "properties": {
                        "incident_number": {
                            "type": "string",
                            "description": "The incident number from IssueCreatorTool to be analyzed and debugged"
                        }
                    },
                    "required": ["incident_number"]
                }
            },
            "class": "tools.incident_debugging_agent_tool.IncidentDebuggingAgentTool"
        },
        {
            "name": "knowledge_base_agent",
            "function": "aaosa_call",
            "instructions": """
            Hello! I'm your Knowledge Base Assistant. I provide answers to frequently asked questions about access management, policies, and procedures.

            **MY KNOWLEDGE BASE (15 ServiceNow FAQs):**

            I have comprehensive knowledge about ServiceNow processes, procedures, and troubleshooting. Each FAQ below contains detailed step-by-step instructions.

            **Q1: How to relate/unrelate IT change to Incident**

**A:**
Open the incident and go to Related Records. Enter the IT change number if you want to relate it, or remove the IT change number you want to unlink. Save the incident record to apply changes.

---

            **Q: How to add/Remove relationships from an application**

**A:**
There are two methods:

1. Transform Map (for bulk data)
2. Manual Update (for small changes)

**Method 1: Transform Map**
Navigate to the IT Service Catalog Portal and create a service request for relationship management.
For bulk data operations, use the transform map with the following field mappings:
- Parent: Application service name
- Parent class: Table name
- Child: Server name
- Child class: Table name of child
- Type: Depends on / Used by
- Relationships: ADD/Delete
- Option: Name and class load

**Method 2: Manual Update**
For one or two records, go directly to the CMDB Relationships table (cmdb_rel_ci_list.do) in ServiceNow.

**Method 3: For Linux/Windows servers or databases**
Application Managers can map/unmap relationships using the "Manage my application service" catalog item.

---

              **Q: How to Modify Group Ownership**

**A:**
To claim ownership of a particular group or multiple groups:

1. Go to the IT Service Catalog Portal
2. Navigate to IT Services -> ServiceNow -> Manage ServiceNow Group (or search in the Search box)
3. Click on the "Manage ServiceNow Group (Single Group)" catalog item
4. Select the group you want to claim as manager
5. Review the existing group owner details displayed
6. Select the checkbox "I am claiming the ownership of this group" and click Order Now

After submission, the request goes to the existing group manager for approval. Once approved, you become the new group manager.

**For multiple groups:**
- Select the checkbox "I also want to claim other groups of this request"
- Select the additional groups you want to manage
- Click Order Now
- Each group requires approval from its existing manager

---

              **Q: How to Get access to the IT Operations Handbook**

**A:**
Prerequisites to create/edit Handbook entries:

1. User must be either Application Manager (AM), Deputy Application Manager, or Service Operations Engineer of any application
2. Complete the Application Management Handbook Assessment training
3. Provide the training transcript to the ServiceNow administrator for verification
4. Once verified, you will be added to the IT Application Managers group

---

              **Q: How to Excel export ServiceNow table data**

**A:**
1. From the application navigator, go to the table containing the data you need
2. Click on the Column Options menu
3. Go to Export -> Excel
4. The data will download as an Excel file

---

              **Q: How can application managers manage their applications in Application Portfolio Management**

**A:**
ServiceNow Application Portfolio Management provides several tools for application managers:

**Available Service Catalogues:**
- Application Onboarding
- Manage My Application Inventory
- Manage My Application Information
- Manage Support Team Assignment
- Manage Business Unit Assignment
- Application Management Handover
- Manage Application Categorization
- Application Retirement

**Resources Available:**
- Application View — View your Application details
- Knowledge Articles — Documentation for each Service Catalogue
- Training Videos — Training for Catalogue Request forms
- Contact your Support Team's Technical Account Managers for assistance

Note: If you do not have Application Manager privileges or are not managing any application, you may see a blank page or access denied message.

---

  **Q: How to Create a ServiceNow IT Group**

**A:**
Use the "Create ServiceNow IT Group" catalog item to onboard a new group.

**Group naming requirements:**
- Name should be maximum 32 characters
- Must start with the Function name prefix (e.g., IT, HR, FIN, etc.)
- Parent group should be mapped
- Ticket type should not contain duplicates
- Owner must be specified
- Application ID is required when creating a new group

---

            **Q: How to create a New Application in ServiceNow Application Portfolio Management**

**A:**
**Pre-Requisites:**
- Draft version of the enterprise request needs to be created
- Architecture approval or Pre-Alignment with Enterprise Architect is required
- Application Manager must complete Application Management Handbook training
- Business/functional owners must complete Business System Owner training (separate tracks for regulated and non-regulated applications)

**Steps to raise a service request:**
1. Go to IT Service Portal
2. Search for "Onboard an Application" in the Service Catalogue
3. Click to open the Service Catalogue form

**Required Fields:**

*Ownership:*
- Requested for (defaults to requester)
- Application Name (as per enterprise request)
- Application Description/Comments
- Enterprise Request ID
- Initial Live Date (future date)
- Business/Functional Owner

*Categorization (coordinate with Architecture team):*
- Application Type
- Application Characteristics
- Application Technical Category
- Application Functional Category
- Architecture Standardization Level
- Supported Business Capabilities

*Organizational Breakdown:*
- Support Team
- Business Unit

**Approval Workflow:**
1. Request goes to Application Manager (AM) for approval (bypassed if AM submits)
2. Then goes to Architecture Approval
3. Once approved, Application record is created with status "Planned for Implementation"
4. Application Lifecycle Status becomes editable after enterprise request approval

---

            **Q: How to update/create/delete groups**

**A:**
Use the Group Management catalog item in ServiceNow.

**Prerequisites:**
- Your user ID must be present in the APS accounts table
- This applies to all environments (PROD/TEST/DEV)

**To create a new group:**
1. Access the Group Management catalog
2. Choose the appropriate template
3. Fill in the required details
4. Application ID is mandatory for new groups

---

            **Q: How to update Service Offering in a Catalog item**

**A:**
1. Go to Maintain Items
2. Search for the catalog item whose offering needs updating
3. Open the Catalog item
4. Update the Service Offering field with the desired value
5. Save the changes

---

            **Q: How to add Interactive Filter to Dashboard**

**A:**
1. Type "Interactive Filter" in the filter navigation under Reports
2. Click New to create a new filter
3. Select the Field Type as required
4. If it's a reference field, select the table name and filter criteria
5. Save the record
6. Add the filter to your dashboard

---

            **Q: How to create Business Services**

**A:**
Only Technical and Business Services (Service Classification) can be created. Application Services cannot be created directly.

**Steps:**
1. Go to the CMDB CI Service List (cmdb_ci_service_list.do)
2. Click the New button
3. Fill in the form with required details

**For modifications:**
- Use the "Manage my Application Service" knowledge article
- To update Application ID for Business/Application Services, go to the CMDB CI Service List and update the Application ID field

---

            **Q: How to Create Service Offerings**

**A:**
1. Go to Service Offering List (service_offering_list.do)
2. Click the New button
3. Fill in the form with required details
4. Save the record

**For modifications:**
- Obtain approvals from "Managed by" and "Deputy Managed by" contacts before making changes

---

              **Q: What is the Special Use Retirement Process in Application Portfolio Management**

**A:**
Special Use Retirement is used for:
- Duplicate application records in ServiceNow
- Applications created in error
- Legacy service entries
- Non-managed applications

**Process:**
1. Document the reason for removal
2. Inform your Technical Account Manager about the special circumstances and get approval
3. Fill out the Retirement Plan & Report Template
4. In the template:
   - Write detailed information and reason in Page 2 - Section: Purpose
   - Mark all required actions as NO, except action #27 (mark YES)
   - Write justification in the last column for each action except #27
5. Complete action #27, obtain required signatures
6. Raise a Retirement request using "Retire My Application Service" catalog
7. Attach the signed Special Use retirement Report

**Checklist before retirement:**
- Are all CIs/Servers/Databases de-linked?
- Is there infrastructure to be decommissioned?
- Are there Application Services that need retirement?
- Is the application within the managed services contract scope? (Will need de-scoping)

---

            **Q: How to cancel a Service Request from the portal**

**A:**
1. Go to the Enterprise Services Portal
2. Click on "My Tickets" in the left panel
3. Find the ticket you want to cancel in the list
4. Click on "Action" -> "Cancel"
5. In the pop-up, enter a reason for cancellation
6. Click OK to confirm

Note: SR Coordinators (members of the SR Coord group) can also cancel requests at the RITM level.

            **HOW I WORK:**
            - I search through these FAQs to find the most relevant answer to your question
            - If I find a close match, I'll provide the full answer
            - If your question doesn't match any FAQ, I'll let you know and suggest contacting the appropriate team
            - For complex issues, I may recommend creating a support ticket or talking to a specialist

            What question can I help you with today?
            """,
            "llm_config": {
                "model_name": "gpt-4o",
                "temperature": 0.3
            }
        }
    ]
}